on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    types: [ opened, synchronize, reopened, closed, labeled, unlabeled ]

jobs:
  tflint:
    name: Lint Terraform Code
    runs-on: ubuntu-latest

    steps:
      - uses: webfactory/ssh-agent@v0.8.0
        with:
          ssh-private-key: |
            ${{ secrets.ORG_ACCESS_SSH_KEY }}

      - name: Clone repo
        uses: actions/checkout@master

      - name: Install Terraform
        uses: hashicorp/setup-terraform@v2

      # Run init to get module code to be able to use `--module`
      - name: Terraform init
        run: |
          terraform init

      - name: Terraform fmt
        run: terraform  fmt -check -recursive

      # More complex example
      - name: tflint
        uses: reviewdog/action-tflint@master
        with:
          github_token: ${{ github.token }}
          reporter: github-pr-review
          fail_on_error: "false"        # Optional. Fail action if errors are found
          tflint_rulesets: "aws"        # Optional. Extra official rulesets to install
          flags: "--module --recursive" # Optional. Add custom tflint flags